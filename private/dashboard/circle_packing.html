<!-- this is the template for zoom circle packing
using the flare.json default file. attempting to create hover functions -->
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Circle Packing</title>
    <style type="text/css">

      /* text {
        font-size: 11px;
        pointer-events: none;
      }       

      text.parent {
        fill: #1f77b4;
      } */

      /* this defines the style rules for circles - mainly the leaves */
      circle {
        fill: #E8D6CA;
        stroke: #757474;
        pointer-events: all;
      }

      /* if a circle is a parent, it has different style rules */
      circle.parent {
        fill: #517A56;
        fill-opacity: .15;
        stroke: #325437;
      }

      /* when a parent is hovered over, the color of the outline changes */
      circle.parent:hover {
        stroke: #FA7805;
        stroke-width: .5px;
      }

      circle.child {
        /* pointer-events: none; */
      }

      /* when a child is hovered over the stroke changes color */
      circle.child:hover {
        stroke: #148718;
        stroke-width: .5px;
      }

      /* this defines the style rules of the div that is used to  make a hovering label */
      #tooltip {
        position: absolute;
        width: 300px;
        height: auto;
        padding: 3px;
        background-color: white;
       /* -webkit-border-radius: 5px;
        -moz-border-radius: 5px;
        border-radius: 5px; 
        -webkit-box-shadow: 4px 4px 5px rgba(0, 0, 0, 0.4);
        -moz-box-shadow: 4px 4px 5px rgba(0, 0, 0, 0.4);
        box-shadow: 4px 4px 5px rgba(0, 0, 0, 0.4); */
        pointer-events: none;
      }

      /* when the tooltip has the hidden class, it is hidden from view */
      #tooltip.hidden {
        display: none;
      }

      /* this defines the style rules of the writing inside the tooltip */
      #tooltip p {
        margin: 0;
        text-align: center;
        font-family: sans-serif;
        font-size: 12px;
        line-height: 20px;
      }
    </style>
  </head>
  
  <body>
    <!-- this makes the div that is the tooltip, making it hidden at first. it puts the value of the item it is at inside. -->
    <div id="tooltip" class="hidden">
      <p><span id="value"></span></p>
    </div>

    <script type="text/javascript" src="d3/d3.js"></script>
    <script type="text/javascript">

      var w = 1280, //width of the svg
          h = 800, //height of the svg
          r = 750, //size of the layout
          xScale = d3.scale.linear().range([0, r]), //scale to remap x coordinates when zoomed
          yScale = d3.scale.linear().range([0, r]), //scale to remap y coordinates when zoomed
          node,
          root;

      //puts the layout for the circle packing diagram into a variable
      var pack = d3.layout.pack()
                   .size([r, r]) //the size of the layout
                   .value(function(d) {return d.name.length})
                   //.value(function(d) { return d.size; }) //returns the size of all of the nodes through the json file.

      //same typical way to make a svg, and then moving it.
      var vis = d3.select("body")
                  .insert("svg:svg", "h2")
                  .attr("width", w)
                  .attr("height", h)
                  .append("svg:g")
                  .attr("transform", "translate(" + (w - r) / 4 + "," + (h - r) / 4 + ")");

      //function that reads the json file and then feeds it into the layout
      d3.json("biggest_subtree_result_1.json", function(data) {
        //this sets the first node of the data to the root of the hierarchy. 
        node = root = data;

        //this runs the pack layout and returns the array of the nodes
        var nodes = pack.nodes(root);

        //selects all of the circles
        vis.selectAll("circle")
          //gets the data for the circles from the node array
           .data(nodes)
           .enter()
           .append("svg:circle")
           //i dont know what this line does
           .attr("class", function(d) { return d.children ? "parent" : "child"; })
           //returns the (x,y) coordinates and the radius of the circles that has been generated by the layout
           .attr("cx", function(d) { return d.x; })
           .attr("cy", function(d) { return d.y; })
           .attr("r", function(d) { return d.r; })
           //this creates the hover div tooltip when the circles are moused over
           .on("mouseover", function(d) {
              //the variables for the (x,y) position of the tooltip depending on the location of the circles
              var xPosition = parseFloat(d3.select(this).attr("cx"));
              var yPosition = parseFloat(d3.select(this).attr("cy"));

              //selects the tooltip and sets its location and the value that goes inside it
              d3.select("#tooltip")
                .style("left", xPosition + "px")
                .style("top", yPosition + "px")
                .select("#value")
                .text(d.name);

              //changes the tooltip to visable
              d3.select("#tooltip").classed("hidden", false);
           })
           //when the mouse leaves the circle, the hidden class is added back on and the div disappears
           .on("mouseout", function() {
              d3.select("#tooltip").classed("hidden", true);

           })
           //when the circles are clicked they are zoomed in on
           .on("click", function(d) { return zoom(node == d ? root : d); });

           /* vis.selectAll("text")
              .data(nodes)
              .enter().append("svg:text")
              .attr("class", function(d) { return d.children ? "parent" : "child"; })
              .attr("x", function(d) { return d.x; })
              .attr("y", function(d) { return d.y; })
              .attr("dy", ".35em")
              .attr("text-anchor", "middle")
              .style("opacity", function(d) { return d.r > 20 ? 1 : 0; })
              .text(function(d) { return d.name; }); */
        //this states that when the window is clicked it will zoom in on the node that was clicked
        d3.select(window).on("click", function() { zoom(root); });
      });

      //this is the zoom function that is used to zoom in on the circles
      function zoom(d, i) {
        var k = r / d.r / 2;
        //this rescales the layout
        xScale.domain([d.x - d.r, d.x + d.r]);
        yScale.domain([d.y - d.r, d.y + d.r]);

        //this transitions the zoom
        var t = vis.transition()
                   .duration(d3.event.altKey ? 7500 : 750);

        //this selects all of the circles and returns their rescaled sizes and radii
        t.selectAll("circle")
         .attr("cx", function(d) { return xScale(d.x); })
         .attr("cy", function(d) { return yScale(d.y); })
         .attr("r", function(d) { return k * d.r; });

        /* t.selectAll("text")
         .attr("x", function(d) { return x(d.x); })
         .attr("y", function(d) { return y(d.y); })
         .style("opacity", function(d) { return k * d.r > 20 ? 1 : 0; }); */

        //i don't know what this does either
        node = d;
        d3.event.stopPropagation();
      }

    </script>
  </body>
</html>
